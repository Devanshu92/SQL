-- Write a SQL query to find the median salary of each company
-- Bonus points if you can solve it without using built-in SQL functions

DROP TABLE IF EXISTS EMPLOYEE ;
CREATE TABLE EMPLOYEE
(
EMP_ID INT,
COMPANY VARCHAR(10),
SALARY INT
);

INSERT INTO EMPLOYEE VALUES (1,'A',2341)
INSERT INTO EMPLOYEE VALUES (2,'A',341)
INSERT INTO EMPLOYEE VALUES (3,'A',15)
INSERT INTO EMPLOYEE VALUES (4,'A',15314)
INSERT INTO EMPLOYEE VALUES (5,'A',451)
INSERT INTO EMPLOYEE VALUES (6,'A',513)
INSERT INTO EMPLOYEE VALUES (7,'B',15)
INSERT INTO EMPLOYEE VALUES (8,'B',13)
INSERT INTO EMPLOYEE VALUES (9,'B',1154)
INSERT INTO EMPLOYEE VALUES (10,'B',1345)
INSERT INTO EMPLOYEE VALUES (11,'B',1221)
INSERT INTO EMPLOYEE VALUES (12,'B',234)
INSERT INTO EMPLOYEE VALUES (13,'C',2345)
INSERT INTO EMPLOYEE VALUES (14,'C',2645)
INSERT INTO EMPLOYEE VALUES (15,'C',2645)
INSERT INTO EMPLOYEE VALUES (16,'C',2652)
INSERT INTO EMPLOYEE VALUES (17,'C',65);

----- SOLUTION 1 ----------
SELECT COMPANY,SUM(SALARY)/COUNT(1) AS MEDIAN_SALARY
-- COUNT(1) WILL GIVE 2 RECORDS FOR EVEN NUMBER AND 1 RECORD FOR ODD NUMBER
FROM
(
SELECT *
,ROW_NUMBER() OVER (PARTITION BY COMPANY ORDER BY SALARY ) AS EMP_CNT
,COUNT(1) OVER(PARTITION BY COMPANY ORDER BY SALARY ROWS BETWEEN UNBOUNDED PRECEDING  AND UNBOUNDED FOLLOWING ) AS TOTAL_CNT
,TOTAL_CNT*1.0/2 AS EVEN_DIVISION
,TOTAL_CNT*1.0/2 + 1 AS ODD_DIVISION
FROM EMPLOYEE
)
WHERE EMP_CNT BETWEEN EVEN_DIVISION AND ODD_DIVISION
GROUP BY 1